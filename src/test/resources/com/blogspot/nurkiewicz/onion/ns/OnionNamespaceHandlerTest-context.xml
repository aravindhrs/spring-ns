<?xml version="1.0" encoding="UTF-8"?>
<beans xmlns="http://www.springframework.org/schema/beans"
       xmlns:onion="http://nurkiewicz.blogspot.com/spring/onion/spring-onion.xsd"
       xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
       xmlns:util="http://www.springframework.org/schema/beans"
       xmlns:jdbc="http://www.springframework.org/schema/jdbc"
       xsi:schemaLocation="http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd
	       http://nurkiewicz.blogspot.com/spring/onion/spring-onion.xsd http://nurkiewicz.blogspot.com/spring/onion/spring-onion.xsd
	       http://www.springframework.org/schema/jdbc http://www.springframework.org/schema/jdbc/spring-jdbc.xsd">

	<jdbc:embedded-database id="dataSource" type="H2"/>
	<bean id="transactionManager" class="org.springframework.jdbc.datasource.DataSourceTransactionManager">
		<constructor-arg ref="dataSource"/>
	</bean>


	<bean id="convertersFactory" class="com.blogspot.nurkiewicz.onion.ConvertersFactory"/>

	<onion:converter format="html"/>
	<onion:converter format="json"/>
	<onion:converter format="error" lenient="false"/>

	<!-- FOO -->
	<bean id="fooController" class="com.blogspot.nurkiewicz.onion.FooController" scope="prototype">
		<constructor-arg ref="fooService"/>
		<property name="errorMapping">
			<util:map>
				<entry key="404" value="not-found.html"/>
				<entry key="503" value="error.html"/>
			</util:map>
		</property>
	</bean>
	<bean id="fooService" class="com.blogspot.nurkiewicz.onion.FooService">
		<constructor-arg ref="fooRepository"/>
		<property name="converters">
			<util:list>
				<ref bean="jsonConverter"/>
				<ref bean="errorConverter"/>
			</util:list>
		</property>
	</bean>
	<bean id="fooRepository" class="com.blogspot.nurkiewicz.onion.FooRepository" init-method="init" destroy-method="destroy">
		<property name="entityName" value="Foo"/>
		<property name="table" value="FOO"/>
		<property name="dataSource" ref="dataSource"/>
		<property name="transactionManager" ref="transactionManager"/>
	</bean>

	<!-- BAR -->
	<bean id="barController" class="com.blogspot.nurkiewicz.onion.BarController" scope="prototype">
		<constructor-arg ref="barService"/>
		<property name="errorMapping">
			<util:map>
				<entry key="404" value="not-found.html"/>
				<entry key="503" value="error.html"/>
			</util:map>
		</property>
	</bean>
	<bean id="barService" class="com.blogspot.nurkiewicz.onion.BarService">
		<constructor-arg ref="barRepository"/>
		<property name="converters">
			<util:list>
				<ref bean="jsonConverter"/>
				<ref bean="htmlConverter"/>
				<ref bean="errorConverter"/>
			</util:list>
		</property>
	</bean>
	<bean id="barRepository" class="com.blogspot.nurkiewicz.onion.BarRepository" init-method="init" destroy-method="destroy">
		<property name="entityName" value="Bar"/>
		<property name="table" value="BAR"/>
		<property name="dataSource" ref="dataSource"/>
		<property name="transactionManager" ref="transactionManager"/>
	</bean>

	<!-- BUZZ -->
	<bean id="buzzController" class="com.blogspot.nurkiewicz.onion.BuzzController" scope="prototype">
		<constructor-arg ref="buzzService"/>
		<property name="errorMapping">
			<util:map>
				<entry key="404" value="not-found.html"/>
				<entry key="503" value="error.html"/>
			</util:map>
		</property>
	</bean>
	<bean id="buzzService" class="com.blogspot.nurkiewicz.onion.BuzzService">
		<constructor-arg ref="buzzRepository"/>
		<property name="converters">
			<util:list>
				<ref bean="jsonConverter"/>
				<ref bean="errorConverter"/>
			</util:list>
		</property>
	</bean>
	<bean id="buzzRepository" class="com.blogspot.nurkiewicz.onion.BuzzRepository" init-method="init" destroy-method="destroy">
		<property name="entityName" value="Buzz"/>
		<property name="table" value="BUZZ"/>
		<property name="dataSource" ref="dataSource"/>
		<property name="transactionManager" ref="transactionManager"/>
	</bean>

	<!--
		<onion:entity class="html">
			<onion:page response="404" dest="not-found"/>
			<onion:page response="503" dest="error"/>
		</onion:entity>
	-->

</beans>
